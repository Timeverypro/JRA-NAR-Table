<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JRA/NAR Á´∂È¶¨Áï™ÁµÑË°®</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .race-time {
            font-weight: 600;
            color: #1e40af; /* Blue 700 */
        }
        .special-race {
            color: #991b1b; /* Red 800 */
            font-weight: 700;
        }
        .tab-active {
            border-bottom: 3px solid #1d4ed8; /* Blue 600 */
            color: #1d4ed8;
            font-weight: 700;
        }
        .lang-active {
            background-color: #1d4ed8; /* Blue 600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto bg-white shadow-xl rounded-xl p-4 md:p-8">
        
        <!-- Header and Language Selector -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 border-b pb-2">
            <h1 id="main-title" class="text-2xl md:text-3xl font-bold text-gray-800 mb-4 sm:mb-0">
                üáØüáµ Êú¨Êó•„ÅÆÁ´∂È¶¨Áï™ÁµÑË°®
            </h1>
            <div id="language-selector" class="flex space-x-2 p-1 rounded-full bg-gray-100 shadow-inner">
                <button data-lang="ja" class="lang-button text-sm font-semibold text-gray-600 px-3 py-1 rounded-full transition duration-150 ease-in-out">JA</button>
                <button data-lang="en" class="lang-button text-sm font-semibold text-gray-600 px-3 py-1 rounded-full transition duration-150 ease-in-out">EN</button>
                <button data-lang="th" class="lang-button text-sm font-semibold text-gray-600 px-3 py-1 rounded-full transition duration-150 ease-in-out">TH</button>
            </div>
        </div>

        <!-- Track Selection Tabs -->
        <div id="track-tabs" class="flex flex-wrap border-b border-gray-200 mb-6 text-sm md:text-base">
            <button id="tab-tokyo" data-track="tokyo" class="tab-button px-4 py-2 rounded-t-lg transition duration-150 ease-in-out">Êù±‰∫¨</button>
            <button id="tab-kyoto" data-track="kyoto" class="tab-button px-4 py-2 rounded-t-lg transition duration-150 ease-in-out">‰∫¨ÈÉΩ</button>
            <button id="tab-obihiro" data-track="obihiro" class="tab-button px-4 py-2 rounded-t-lg transition duration-150 ease-in-out">Â∏ØÂ∫É</button>
            <button id="tab-mizusawa" data-track="mizusawa" class="tab-button px-4 py-2 rounded-t-lg transition duration-150 ease-in-out">Ê∞¥Ê≤¢</button>
            <button id="tab-kochi" data-track="kochi" class="tab-button px-4 py-2 rounded-t-lg transition duration-150 ease-in-out">È´òÁü•</button>
            <button id="tab-saga" data-track="saga" class="tab-button px-4 py-2 rounded-t-lg transition duration-150 ease-in-out">‰ΩêË≥Ä</button>
        </div>

        <div id="schedule-header" class="mb-4 text-gray-600 text-sm md:text-base">
            <!-- Dynamic header info will go here -->
        </div>

        <!-- Schedule Table Container -->
        <div id="schedule-container" class="overflow-x-auto relative">
            <table class="min-w-full divide-y divide-gray-200 rounded-lg shadow-md">
                <thead class="bg-gray-50 sticky top-0">
                    <tr id="table-header-row">
                        <!-- Header will be dynamically loaded -->
                    </tr>
                </thead>
                <tbody id="schedule-body" class="bg-white divide-y divide-gray-100">
                    <!-- Race schedule rows will be dynamically loaded -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // --- JRA RACE NAME MAPPING ---
        // Maps Japanese race names to internal keys for robust translation
        const raceNameMap = {
            "2Ê≠≥Êú™ÂãùÂà©": "RACE_2YO_UNBEATEN",
            "2Ê≠≥Êñ∞È¶¨": "RACE_2YO_NEW",
            "3Ê≠≥‰ª•‰∏ä1Âãù„ÇØ„É©„Çπ": "RACE_3YO_PLUS_1WIN",
            "3Ê≠≥‰ª•‰∏äÈöúÂÆ≥Êú™ÂãùÂà©": "RACE_3YO_PLUS_HANDICAP_UNBEATEN",
            "3Ê≠≥‰ª•‰∏ä2Âãù„ÇØ„É©„Çπ": "RACE_3YO_PLUS_2WIN",
            "„Éô„Ç¥„Éã„Ç¢Ë≥û": "RACE_BEGONIA_STAKES",
            "„Ç™„É™„Ç®„É≥„Çø„É´Ë≥û (2Âãù)": "RACE_ORIENTAL_STAKES",
            "„Ç¢„Éó„É≠„Éº„Ç∫Ë≥û (2Âãù)": "RACE_APPLAUSE_STAKES",
            "„Ç¶„Çß„É´„Ç´„É†S (3Âãù)": "RACE_WELCOME_STAKES",
            "„Ç∏„É£„Éë„É≥C (GI) / WIN5": "RACE_JAPAN_CUP",
            "ÁôΩËèäË≥û (1Âãù)": "RACE_SHIRAGIKU_STAKES",
            "Ëä±ÂúíS (3Âãù)": "RACE_HANAZONO_STAKES",
            "A„É™„Éº„ÉïS (OP) / WIN5": "RACE_ALEAF_STAKES",
            "‰∫¨Èò™ÊùØ (GIII) / WIN5": "RACE_KEIHAN_HAI",

            // --- NAR RACE NAME MAPPING (Generic/Common classes) ---
            "C1": "RACE_CLASS_C1",
            "C2": "RACE_CLASS_C2",
            "C3": "RACE_CLASS_C3",
            "C1-7": "RACE_CLASS_C1_7",
            "C1-6": "RACE_CLASS_C1_6",
            "C1-5": "RACE_CLASS_C1_5",
            "C1-4": "RACE_CLASS_C1_4",
            "C3-3": "RACE_CLASS_C3_3",
            "C3-2": "RACE_CLASS_C3_2",
            "B": "RACE_CLASS_B",
            "B1-3": "RACE_CLASS_B1_3",
            "A2": "RACE_CLASS_A2",
            "2Ê≠≥": "RACE_2YO_ONLY",
            "2Ê≠≥-3": "RACE_2YO_3",
            "2Ê≠≥-2": "RACE_2YO_2",
            "2Ê≠≥Êñ∞È¶¨": "RACE_2YO_NEW", // Re-used JRA key for 2-year-old races
            "„Éï„Ç°„Ç§„Éä„É´„É¨„Éº„Çπ(C3)": "RACE_FINAL_C3"
        };

        const translations = {
            ja: {
                title: "üáØüáµ Êú¨Êó•„ÅÆÁ´∂È¶¨Áï™ÁµÑË°®",
                tokyo: "Êù±‰∫¨", kyoto: "‰∫¨ÈÉΩ", obihiro: "Â∏ØÂ∫É", mizusawa: "Ê∞¥Ê≤¢", kochi: "È´òÁü•", saga: "‰ΩêË≥Ä",
                jra_track_name: (name) => name,
                jra_r: "R", jra_time: "Áô∫Ëµ∞ÊôÇÈñì", jra_name: "„É¨„Éº„ÇπÂêç", jra_distance: "Ë∑ùÈõ¢", jra_horses: "È†≠Êï∞",
                jra_status: (date, weather) => `${date} | ${weather}`,
                
                // JRA Standard
                RACE_2YO_UNBEATEN: "2Ê≠≥Êú™ÂãùÂà©", RACE_2YO_NEW: "2Ê≠≥Êñ∞È¶¨", RACE_3YO_PLUS_1WIN: "3Ê≠≥‰ª•‰∏ä1Âãù„ÇØ„É©„Çπ",
                RACE_3YO_PLUS_HANDICAP_UNBEATEN: "3Ê≠≥‰ª•‰∏äÈöúÂÆ≥Êú™ÂãùÂà©", RACE_3YO_PLUS_2WIN: "3Ê≠≥‰ª•‰∏ä2Âãù„ÇØ„É©„Çπ",
                RACE_BEGONIA_STAKES: "„Éô„Ç¥„Éã„Ç¢Ë≥û", RACE_ORIENTAL_STAKES: "„Ç™„É™„Ç®„É≥„Çø„É´Ë≥û (2Âãù)",
                RACE_APPLAUSE_STAKES: "„Ç¢„Éó„É≠„Éº„Ç∫Ë≥û (2Âãù)", RACE_WELCOME_STAKES: "„Ç¶„Çß„É´„Ç´„É†S (3Âãù)",
                RACE_JAPAN_CUP: "„Ç∏„É£„Éë„É≥C (GI) / WIN5", RACE_SHIRAGIKU_STAKES: "ÁôΩËèäË≥û (1Âãù)",
                RACE_HANAZONO_STAKES: "Ëä±ÂúíS (3Âãù)", RACE_ALEAF_STAKES: "A„É™„Éº„ÉïS (OP) / WIN5",
                RACE_KEIHAN_HAI: "‰∫¨Èò™ÊùØ (GIII) / WIN5",
                
                // NAR Standard
                RACE_CLASS_C1: "C1„ÇØ„É©„Çπ", RACE_CLASS_C2: "C2„ÇØ„É©„Çπ", RACE_CLASS_C3: "C3„ÇØ„É©„Çπ",
                RACE_CLASS_C1_7: "C1-7ÁµÑ", RACE_CLASS_C1_6: "C1-6ÁµÑ", RACE_CLASS_C1_5: "C1-5ÁµÑ",
                RACE_CLASS_C1_4: "C1-4ÁµÑ", RACE_CLASS_C3_3: "C3-3ÁµÑ", RACE_CLASS_C3_2: "C3-2ÁµÑ",
                RACE_CLASS_B: "B„ÇØ„É©„Çπ", RACE_CLASS_B1_3: "B1-3ÁµÑ", RACE_CLASS_A2: "A2„ÇØ„É©„Çπ",
                RACE_2YO_ONLY: "2Ê≠≥", RACE_2YO_3: "2Ê≠≥-3", RACE_2YO_2: "2Ê≠≥-2",
                RACE_FINAL_C3: "„Éï„Ç°„Ç§„Éä„É´„É¨„Éº„Çπ(C3)",

                SPECIAL_HEAVY: "ÈáçË≥û", SPECIAL_SPECIAL: "ÁâπÂà•",
            },
            en: {
                title: "üáØüáµ Today's Horse Racing Schedule",
                tokyo: "Tokyo", kyoto: "Kyoto", obihiro: "Obihiro", mizusawa: "Mizusawa", kochi: "Kochi", saga: "Saga",
                jra_track_name: (name) => name.replace("Á´∂È¶¨Â†¥", " Racecourse"),
                jra_r: "R", jra_time: "Start Time", jra_name: "Race Name", jra_distance: "Distance", jra_horses: "Runners",
                jra_status: (date, weather) => `${date.replace('Âõû', 'th Round')} | ${weather.replace('Â§©Ê∞ó: ', 'Weather: ').replace('È¶¨Â†¥: ', 'Track: ').replace('ËâØ', 'Good')}`,
                
                // JRA Standard
                RACE_2YO_UNBEATEN: "2yo Unbeaten", RACE_2YO_NEW: "2yo Newcomer", RACE_3YO_PLUS_1WIN: "3yo+ 1 Win Class",
                RACE_3YO_PLUS_HANDICAP_UNBEATEN: "3yo+ Steeplechase Unbeaten", RACE_3YO_PLUS_2WIN: "3yo+ 2 Win Class",
                RACE_BEGONIA_STAKES: "Begonia Stakes", RACE_ORIENTAL_STAKES: "Oriental Stakes (2 Win)",
                RACE_APPLAUSE_STAKES: "Applause Stakes (2 Win)", RACE_WELCOME_STAKES: "Welcome S (3 Win)",
                RACE_JAPAN_CUP: "Japan Cup (GI) / WIN5", RACE_SHIRAGIKU_STAKES: "Shiragiku Stakes (1 Win)",
                RACE_HANAZONO_STAKES: "Hanazono S (3 Win)", RACE_ALEAF_STAKES: "A-Leaf S (OP) / WIN5",
                RACE_KEIHAN_HAI: "Keihan Hai (GIII) / WIN5",

                // NAR Standard
                RACE_CLASS_C1: "Class C1", RACE_CLASS_C2: "Class C2", RACE_CLASS_C3: "Class C3",
                RACE_CLASS_C1_7: "Class C1-7", RACE_CLASS_C1_6: "Class C1-6", RACE_CLASS_C1_5: "Class C1-5",
                RACE_CLASS_C1_4: "Class C1-4", RACE_CLASS_C3_3: "Class C3-3", RACE_CLASS_C3_2: "Class C3-2",
                RACE_CLASS_B: "Class B", RACE_CLASS_B1_3: "Class B1-3", RACE_CLASS_A2: "Class A2",
                RACE_2YO_ONLY: "2yo Race", RACE_2YO_3: "2yo-3", RACE_2YO_2: "2yo-2",
                RACE_FINAL_C3: "Final Race (C3)",
                
                SPECIAL_HEAVY: "Grade Race", SPECIAL_SPECIAL: "Special Race",
            },
            th: {
                title: "üáØüáµ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏°‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ",
                tokyo: "‡πÇ‡∏ï‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß", kyoto: "‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß‡πÇ‡∏ï", obihiro: "‡πÇ‡∏≠‡∏¥‡∏ö‡∏¥‡∏Æ‡∏¥‡πÇ‡∏£‡∏∞", mizusawa: "‡∏°‡∏¥‡∏ã‡∏∂‡∏ã‡∏≤‡∏ß‡∏∞", kochi: "‡πÇ‡∏Ñ‡∏à‡∏¥", saga: "‡∏ã‡∏≤‡∏Å‡∏∞",
                jra_track_name: (name) => name.replace("Á´∂È¶¨Â†¥", " ‡∏™‡∏ô‡∏≤‡∏°‡πÅ‡∏Ç‡πà‡∏á‡∏°‡πâ‡∏≤"),
                jra_r: "‡∏£‡∏≠‡∏ö", jra_time: "‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å‡∏ß‡∏¥‡πà‡∏á", jra_name: "‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô", jra_distance: "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á", jra_horses: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏°‡πâ‡∏≤",
                jra_status: (date, weather) => `${date.replace('Âõû', '‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà')} | ${weather.replace('Â§©Ê∞ó: ', '‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®: ').replace('È¶¨Â†¥: ', '‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏ô‡∏≤‡∏°: ')}`,
                
                // JRA Standard
                RACE_2YO_UNBEATEN: "‡∏°‡πâ‡∏≤ 2 ‡∏õ‡∏µ ‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏ä‡∏ô‡∏∞", RACE_2YO_NEW: "‡∏°‡πâ‡∏≤ 2 ‡∏õ‡∏µ ‡∏°‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà", RACE_3YO_PLUS_1WIN: "‡∏°‡πâ‡∏≤ 3 ‡∏õ‡∏µ ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡∏Ñ‡∏•‡∏≤‡∏™ 1 ‡∏ä‡∏ô‡∏∞",
                RACE_3YO_PLUS_HANDICAP_UNBEATEN: "‡∏°‡πâ‡∏≤ 3 ‡∏õ‡∏µ ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡πÅ‡∏Ç‡πà‡∏á‡∏ß‡∏¥‡∏ö‡∏≤‡∏Å ‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏ä‡∏ô‡∏∞", RACE_3YO_PLUS_2WIN: "‡∏°‡πâ‡∏≤ 3 ‡∏õ‡∏µ ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡∏Ñ‡∏•‡∏≤‡∏™ 2 ‡∏ä‡∏ô‡∏∞",
                RACE_BEGONIA_STAKES: "‡πÄ‡∏ö‡πÇ‡∏Å‡πÄ‡∏ô‡∏µ‡∏¢ ‡∏™‡πÄ‡∏ï‡∏Ñ‡∏™‡πå", RACE_ORIENTAL_STAKES: "‡πÇ‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏• ‡∏™‡πÄ‡∏ï‡∏Ñ‡∏™‡πå (2 ‡∏ä‡∏ô‡∏∞)",
                RACE_APPLAUSE_STAKES: "‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏≠‡∏™ ‡∏™‡πÄ‡∏ï‡∏Ñ‡∏™‡πå (2 ‡∏ä‡∏ô‡∏∞)", RACE_WELCOME_STAKES: "‡πÄ‡∏ß‡∏•‡∏Ñ‡∏±‡∏° ‡∏™‡πÄ‡∏ï‡∏Ñ‡∏™‡πå (3 ‡∏ä‡∏ô‡∏∞)",
                RACE_JAPAN_CUP: "‡πÄ‡∏à‡πÅ‡∏õ‡∏ô ‡∏Ñ‡∏±‡∏û (GI) / WIN5", RACE_SHIRAGIKU_STAKES: "‡∏ä‡∏¥‡∏£‡∏≤‡∏Å‡∏¥‡∏Å‡∏∏ ‡∏™‡πÄ‡∏ï‡∏Ñ‡∏™‡πå (1 ‡∏ä‡∏ô‡∏∞)",
                RACE_HANAZONO_STAKES: "‡∏Æ‡∏≤‡∏ô‡∏≤‡πÇ‡∏ã‡πÇ‡∏ô‡∏∞ ‡∏™‡πÄ‡∏ï‡∏Ñ‡∏™‡πå (3 ‡∏ä‡∏ô‡∏∞)", RACE_ALEAF_STAKES: "‡πÄ‡∏≠-‡∏•‡∏µ‡∏ü ‡∏™‡πÄ‡∏ï‡∏Ñ‡∏™‡πå (OP) / WIN5",
                RACE_KEIHAN_HAI: "‡πÄ‡∏Ñ‡∏Æ‡∏±‡∏ô ‡πÑ‡∏Æ (GIII) / WIN5",

                // NAR Standard
                RACE_CLASS_C1: "‡∏Ñ‡∏•‡∏≤‡∏™ C1", RACE_CLASS_C2: "‡∏Ñ‡∏•‡∏≤‡∏™ C2", RACE_CLASS_C3: "‡∏Ñ‡∏•‡∏≤‡∏™ C3",
                RACE_CLASS_C1_7: "‡∏Ñ‡∏•‡∏≤‡∏™ C1-7", RACE_CLASS_C1_6: "‡∏Ñ‡∏•‡∏≤‡∏™ C1-6", RACE_CLASS_C1_5: "‡∏Ñ‡∏•‡∏≤‡∏™ C1-5",
                RACE_CLASS_C1_4: "‡∏Ñ‡∏•‡∏≤‡∏™ C1-4", RACE_CLASS_C3_3: "‡∏Ñ‡∏•‡∏≤‡∏™ C3-3", RACE_CLASS_C3_2: "‡∏Ñ‡∏•‡∏≤‡∏™ C3-2",
                RACE_CLASS_B: "‡∏Ñ‡∏•‡∏≤‡∏™ B", RACE_CLASS_B1_3: "‡∏Ñ‡∏•‡∏≤‡∏™ B1-3", RACE_CLASS_A2: "‡∏Ñ‡∏•‡∏≤‡∏™ A2",
                RACE_2YO_ONLY: "‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏°‡πâ‡∏≤ 2 ‡∏õ‡∏µ", RACE_2YO_3: "‡∏°‡πâ‡∏≤ 2 ‡∏õ‡∏µ-3", RACE_2YO_2: "‡∏°‡πâ‡∏≤ 2 ‡∏õ‡∏µ-2",
                RACE_FINAL_C3: "‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏£‡∏≠‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ (C3)",
                
                SPECIAL_HEAVY: "‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡πÄ‡∏Å‡∏£‡∏î", SPECIAL_SPECIAL: "‡∏û‡∏¥‡πÄ‡∏®‡∏©",
            },
        };

        // --- CORE DATA STRUCTURES ---
        const raceData = {
            // --- JRA DATA (TOKYO) ---
            tokyo: {
                name: "Êù±‰∫¨Á´∂È¶¨Â†¥", date: "5ÂõûÊù±‰∫¨ 8Êó•ÁõÆ", weather: "Â§©Ê∞ó: Êô¥(C) | È¶¨Â†¥: ËâØ", type: "JRA",
                races: [
                    { R: 1, time: "09:30", name: "2Ê≠≥Êú™ÂãùÂà©", distance: "„ÉÄ1400m", horses: 16 },
                    { R: 2, time: "09:55", name: "2Ê≠≥Êú™ÂãùÂà©", distance: "Ëäù1600m", horses: 13 },
                    { R: 3, time: "10:25", name: "2Ê≠≥Êú™ÂãùÂà©", distance: "„ÉÄ1600m", horses: 16 },
                    { R: 4, time: "10:55", name: "2Ê≠≥Êú™ÂãùÂà©", distance: "Ëäù2000m", horses: 13 },
                    { R: 5, time: "11:25", name: "2Ê≠≥Êñ∞È¶¨", distance: "„ÉÄ1600m", horses: 16 },
                    { R: 6, time: "12:15", name: "2Ê≠≥Êñ∞È¶¨", distance: "Ëäù1800m", horses: 12 },
                    { R: 7, time: "12:45", name: "3Ê≠≥‰ª•‰∏ä1Âãù„ÇØ„É©„Çπ", distance: "„ÉÄ1400m", horses: 16 },
                    { R: 8, time: "13:15", name: "„Éô„Ç¥„Éã„Ç¢Ë≥û", distance: "Ëäù1600m", horses: 8, special: true },
                    { R: 9, time: "13:50", name: "„Ç™„É™„Ç®„É≥„Çø„É´Ë≥û (2Âãù)", distance: "Ëäù2000m", horses: 9, special: true },
                    { R: 10, time: "14:25", name: "„Ç¢„Éó„É≠„Éº„Ç∫Ë≥û (2Âãù)", distance: "„ÉÄ1400m", horses: 16, special: true },
                    { R: 11, time: "15:00", name: "„Ç¶„Çß„É´„Ç´„É†S (3Âãù)", distance: "Ëäù2000m", horses: 16, special: true },
                    { R: 12, time: "15:40", name: "„Ç∏„É£„Éë„É≥C (GI) / WIN5", distance: "Ëäù2400m", horses: 18, special: true, heavy: true, win5: true },
                ]
            },
            // --- JRA DATA (KYOTO) ---
            kyoto: {
                name: "‰∫¨ÈÉΩÁ´∂È¶¨Â†¥", date: "4Âõû‰∫¨ÈÉΩ 8Êó•ÁõÆ", weather: "Â§©Ê∞ó: Êô¥ | È¶¨Â†¥: ËâØ", type: "JRA",
                races: [
                    { R: 1, time: "09:40", name: "2Ê≠≥Êú™ÂãùÂà©", distance: "„ÉÄ1200m", horses: 16 },
                    { R: 2, time: "10:10", name: "2Ê≠≥Êú™ÂãùÂà©", distance: "Ëäù1800m", horses: 13 },
                    { R: 3, time: "10:40", name: "2Ê≠≥Êñ∞È¶¨", distance: "Ëäù1200m", horses: 13 },
                    { R: 4, time: "11:10", name: "3Ê≠≥‰ª•‰∏ä1Âãù„ÇØ„É©„Çπ", distance: "„ÉÄ1400m", horses: 16 },
                    { R: 5, time: "11:40", name: "3Ê≠≥‰ª•‰∏äÈöúÂÆ≥Êú™ÂãùÂà©", distance: "Èöú2910m", horses: 9 },
                    { R: 6, time: "12:30", name: "2Ê≠≥Êñ∞È¶¨", distance: "Ëäù2000m", horses: 9 },
                    { R: 7, time: "13:00", name: "3Ê≠≥‰ª•‰∏ä1Âãù„ÇØ„É©„Çπ", distance: "„ÉÄ1800m", horses: 16 },
                    { R: 8, time: "13:30", name: "3Ê≠≥‰ª•‰∏ä2Âãù„ÇØ„É©„Çπ", distance: "Ëäù2200m", horses: 8, special: true },
                    { R: 9, time: "14:05", name: "ÁôΩËèäË≥û (1Âãù)", distance: "Ëäù1600m", horses: 11, special: true },
                    { R: 10, time: "14:40", name: "Ëä±ÂúíS (3Âãù)", distance: "„ÉÄ„Éº„Éà1800m", horses: 16, special: true },
                    { R: 11, time: "15:15", name: "A„É™„Éº„ÉïS (OP) / WIN5", distance: "„ÉÄ1400m", horses: 16, special: true, win5: true },
                    { R: 12, time: "16:15", name: "‰∫¨Èò™ÊùØ (GIII) / WIN5", distance: "Ëäù1200m", horses: 18, special: true, heavy: true, win5: true },
                ]
            },
            // --- NAR DATA (OBIHIRO - Banei) ---
            obihiro: {
                name: "Â∏ØÂ∫ÉÁ´∂È¶¨Â†¥", date: "17ÂõûÂ∏ØÂ∫É(„Å∞) 5Êó•ÁõÆ", weather: "Ëäù: - „ÉÄ: -", type: "NAR", icon: "üèá",
                races: [
                    { R: 1, time: "14:00", name: "Á¨¨5Âõû‰ªäÂπ¥„ÇÇË¶≥Êà¶Âá∫Ëµ∞", distance: "„ÉÄ200m", horses: 10 },
                    { R: 2, time: "14:35", name: "„É™„Éô„É≥„Ç∏‚òÜ„Åø„Åè„Çã„Çπ„Ç∫(2Ê≠≥)", distance: "„ÉÄ200m", horses: 10 },
                    { R: 3, time: "15:05", name: "„Çπ„Ç¶„Ç£„Éº„ÉàÂçÅÂãùÁõÉ(2Ê≠≥)", distance: "„ÉÄ200m", horses: 10 },
                    { R: 4, time: "15:35", name: "Á•ù56„Åó„Åí„Å≤„ÇâË™ïÁîüÁîü(2Ê≠≥)", distance: "„ÉÄ200m", horses: 10 },
                    { R: 5, time: "16:10", name: "ÊäòÂéüËªçÊñó‚òÜÁàÜË™ïÊùØ", distance: "„ÉÄ200m", horses: 9 },
                    { R: 6, time: "16:45", name: "ÂõΩÈâÑÂ∫ÉÂ∞æÁ∑ö96Âë®Âπ¥", distance: "„ÉÄ200m", horses: 9 },
                    { R: 7, time: "17:25", name: "ÂõΩÈâÑÂ£´ÂπåÁ∑ö100Âë®", distance: "„ÉÄ200m", horses: 9 },
                    { R: 8, time: "17:55", name: "Ê†πÂÆ§ÈßÖÂ∏ØÂ∫ÉÈßÖ120(2Ê≠≥)", distance: "„ÉÄ200m", horses: 9 },
                    { R: 9, time: "18:30", name: "ÂçÉÁßã„ÅÇ„Çä„Åå„Å®„ÅÜ", distance: "„ÉÄ200m", horses: 9 },
                    { R: 10, time: "19:00", name: "ÈáßË∑ØÁî£ÁâπÂà• (2Ê≠≥)", distance: "„ÉÄ200m", horses: 10, special: true },
                    { R: 11, time: "19:30", name: "„Å∞„Çì„Åà„ÅÑ„Ç™„Éº„ÇØ„Çπ (3Ê≠≥)", distance: "„ÉÄ200m", horses: 10, special: true, heavy: true },
                    { R: 12, time: "20:05", name: "B1-3", distance: "„ÉÄ200m", horses: 9 },
                ]
            },
            // --- NAR DATA (MIZUSAWA) ---
            mizusawa: {
                name: "Ê∞¥Ê≤¢Á´∂È¶¨Â†¥", date: "7ÂõûÊ∞¥Ê≤¢ 4Êó•ÁõÆ", weather: "Ëäù: - „ÉÄ: -", type: "NAR", icon: "üíß",
                races: [
                    { R: 1, time: "11:50", name: "C2", distance: "„ÉÄ850m", horses: 9 },
                    { R: 2, time: "12:25", name: "C2ÂçÅÁµÑ", distance: "„ÉÄ1300m", horses: 10 },
                    { R: 3, time: "13:05", name: "C2‰πùÁµÑ", distance: "„ÉÄ1300m", horses: 10 },
                    { R: 4, time: "13:40", name: "C2ÂÖ´ÁµÑ", distance: "„ÉÄ1300m", horses: 10 },
                    { R: 5, time: "14:15", name: "2Ê≠≥", distance: "„ÉÄ1300m", horses: 9 },
                    { R: 6, time: "14:50", name: "2Ê≠≥", distance: "„ÉÄ1300m", horses: 10 },
                    { R: 7, time: "15:25", name: "C1", distance: "„ÉÄ850m", horses: 9 },
                    { R: 8, time: "15:55", name: "C1", distance: "„ÉÄ850m", horses: 10 },
                    { R: 9, time: "16:30", name: "C1", distance: "„ÉÄ1400m", horses: 12 },
                    { R: 10, time: "17:05", name: "Â±±ÁéãÂ≤©Ë≥û(C1)", distance: "„ÉÄ1600m", horses: 11, special: true },
                    { R: 11, time: "17:40", name: "Á§æÂè∞„Çπ„Çø„É™„Ç™„É≥„Çπ„ÉÜ(C1)", distance: "„ÉÄ1600m", horses: 12, special: true },
                    { R: 12, time: "18:15", name: "Âåó‰∏äÂ∑ùÂ§ßË≥ûÂÖ∏", distance: "„ÉÄ2500m", horses: 8, special: true, heavy: true },
                ]
            },
            // --- NAR DATA (KOCHI) ---
            kochi: {
                name: "È´òÁü•Á´∂È¶¨Â†¥", date: "11ÂõûÈ´òÁü• 2Êó•ÁõÆ", weather: "Ëäù: - „ÉÄ: -", type: "NAR", icon: "üî•",
                races: [
                    { R: 1, time: "14:55", name: "2Ê≠≥-3", distance: "„ÉÄ1300m", horses: 9 },
                    { R: 2, time: "15:30", name: "2Ê≠≥-2", distance: "„ÉÄ1300m", horses: 9 },
                    { R: 3, time: "16:00", name: "C1-7", distance: "„ÉÄ1600m", horses: 10 },
                    { R: 4, time: "16:35", name: "Â∫ÉÂ≥∂„ÇÇ„Åø„ÅòÁâπÂà•(C1)", distance: "„ÉÄ1600m", horses: 9, special: true },
                    { R: 5, time: "17:05", name: "„ÇÑ„Åæ„Åê„Å°ÂíåÁâõÊåØËààÁâπÂà•(C1)", distance: "„ÉÄ1600m", horses: 11, special: true },
                    { R: 6, time: "17:35", name: "C1-6", distance: "„ÉÄ1600m", horses: 10 },
                    { R: 7, time: "18:10", name: "C1-5", distance: "„ÉÄ1600m", horses: 11 },
                    { R: 8, time: "18:45", name: "C1-4", distance: "„ÉÄ1600m", horses: 10 },
                    { R: 9, time: "19:20", name: "C3-3", distance: "„ÉÄ1400m", horses: 11 },
                    { R: 10, time: "19:50", name: "C3-2", distance: "„ÉÄ1400m", horses: 12 },
                    { R: 11, time: "20:20", name: "„Çø„Éû„É†„É©„Çµ„Ç≠ÁâπÂà•(C3)", distance: "„ÉÄ1400m", horses: 8, special: true },
                    { R: 12, time: "20:50", name: "„Éï„Ç°„Ç§„Éä„É´„É¨„Éº„Çπ(C3)", distance: "„ÉÄ1400m", horses: 8, special: true },
                ]
            },
            // --- NAR DATA (SAGA) ---
            saga: {
                name: "‰ΩêË≥ÄÁ´∂È¶¨Â†¥", date: "15Âõû‰ΩêË≥Ä 4Êó•ÁõÆ", weather: "Ëäù: - „ÉÄ: -", type: "NAR", icon: "üåæ",
                races: [
                    { R: 1, time: "15:50", name: "„Ç¶„ÉûÂ®ò√ó„Çæ„É≥„Éì„É©„É≥(2Ê≠≥)", distance: "„ÉÄ1300m", horses: 12 },
                    { R: 2, time: "16:25", name: "„Å™„Çì„Å¶„Å£„Åü„Å£„Å¶„ÇΩ„É≥(2Ê≠≥)", distance: "„ÉÄ1300m", horses: 9 },
                    { R: 3, time: "16:55", name: "ÈÉΩ‰∏ÄÁï™„ÅÆËä±È≠Å„Å≠„Éº(C1)", distance: "„ÉÄ1400m", horses: 10 },
                    { R: 4, time: "17:30", name: "KYUSHU DR(C1)", distance: "„ÉÄ1400m", horses: 10 },
                    { R: 5, time: "18:05", name: "„Éï„Ç©„Éº„Éû„É´„Éè„Ç¶„ÉàË≥û", distance: "„ÉÄ1400m", horses: 12, special: true, heavy: true },
                    { R: 6, time: "18:40", name: "Ë¶áÁéã„ÅÆGlory!(B)", distance: "„ÉÄ1400m", horses: 11 },
                    { R: 7, time: "19:10", name: "Âè´„ÅπÂãùÂà©„ÅÆÈõÑ„Åü„Åë„Å≥(B)", distance: "„ÉÄ1400m", horses: 10 },
                    { R: 8, time: "19:40", name: "Âäõ„ÄÅ„Åù„Çå„Åì„Åù„ÅåÂãùÂà©!(A2)", distance: "„ÉÄ1400m", horses: 10 },
                    { R: 9, time: "20:10", name: "„Ç¢„É≥„Éâ„É≠„É°„ÉÄÂ∫ßÁâπÈÅ∏(C2)", distance: "„ÉÄ900m", horses: 10, special: true },
                    { R: 10, time: "20:40", name: "SAGA„É™„Éô„É≥„Ç∏„É£(C2)", distance: "„ÉÄ1400m", horses: 12, special: true },
                    // Saga only has 10 races on this specific schedule, but keeping R11/R12 structure for consistency if a new schedule is loaded later.
                ]
            },
        };

        const tracks = raceData;

        // --- GLOBAL STATE & DOM ELEMENTS ---
        let currentLang = 'ja';
        let currentTrackKey = 'tokyo';

        const header = document.getElementById('schedule-header');
        const tableBody = document.getElementById('schedule-body');
        const tableHeaderRow = document.getElementById('table-header-row');
        const tabButtons = document.querySelectorAll('.tab-button');
        const langButtons = document.querySelectorAll('.lang-button');
        const mainTitle = document.getElementById('main-title');


        /**
         * Standardize JRA/NAR race names to translation keys.
         * This runs once at startup.
         */
        function preprocessRaceData() {
            Object.values(raceData).forEach(track => {
                track.races = track.races.map(race => ({
                    ...race,
                    // Check if the name is a mappable key, otherwise use the original name
                    translationKey: raceNameMap[race.name] || race.name,
                }));
            });
        }

        preprocessRaceData(); // Run preprocess once on load


        /**
         * Updates all static text elements in the UI based on the selected language.
         */
        function updateTextElements(lang) {
            const t = translations[lang];

            // 1. Main Title
            mainTitle.textContent = t.title;

            // 2. Tab Buttons
            document.getElementById('tab-tokyo').textContent = t.tokyo;
            document.getElementById('tab-kyoto').textContent = t.kyoto;
            document.getElementById('tab-obihiro').textContent = t.obihiro;
            document.getElementById('tab-mizusawa').textContent = t.mizusawa;
            document.getElementById('tab-kochi').textContent = t.kochi;
            document.getElementById('tab-saga').textContent = t.saga;
        }


        /**
         * Renders the schedule table based on the selected track key and current language.
         * All tracks (JRA and NAR) now use the detailed race card format.
         * @param {string} trackKey - e.g., 'tokyo', 'kochi', 'obihiro'.
         */
        function renderSchedule(trackKey) {
            const data = tracks[trackKey];
            const t = translations[currentLang];

            if (!data) return;

            // 1. Update the overall header
            header.innerHTML = `
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                    <span class="text-xl font-semibold text-gray-800">${t.jra_track_name(data.name)}</span>
                    <span class="text-base text-gray-500 mt-1 sm:mt-0">${t.jra_status(data.date, data.weather)}</span>
                </div>
            `;


            // 2. Generate Table Header (Unified for JRA/NAR)
            const headerHtml = `
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/12">${t.jra_r}</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/12">${t.jra_time}</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-5/12">${t.jra_name}</th>
                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-2/12">${t.jra_distance}</th>
                <th class="px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-2/12">${t.jra_horses}</th>
            `;
            tableHeaderRow.innerHTML = headerHtml;

            // 3. Generate Table Body (Unified for JRA/NAR)
            let bodyHtml = '';
            
            data.races.forEach(race => {
                // Skip empty placeholders
                if (!race.name && !race.horses) return;

                const timeClass = race.special ? 'special-race' : 'race-time';
                const nameClass = race.special ? 'font-semibold text-red-800' : 'text-gray-900';
                
                // Determine badge type
                let badgeContent = '';
                let badgeColor = '';
                if (race.heavy) {
                    badgeContent = t.SPECIAL_HEAVY;
                    badgeColor = 'bg-red-500';
                } else if (race.special) {
                    badgeContent = t.SPECIAL_SPECIAL;
                    badgeColor = 'bg-yellow-500';
                } else if (race.win5) {
                    badgeContent = 'WIN5';
                    badgeColor = 'bg-green-500';
                }

                const badgeHtml = badgeContent ? 
                    `<span class="ml-2 text-xs font-bold text-white ${badgeColor} px-1.5 py-0.5 rounded-full">${badgeContent}</span>` : '';
                
                // Use translation key if available, otherwise use original name
                const translatedRaceName = t[race.translationKey] || race.name;

                bodyHtml += `
                    <tr class="hover:bg-blue-50 transition duration-150 ease-in-out">
                        <td class="px-3 py-3 whitespace-nowrap text-sm font-medium text-blue-800">${race.R}R</td>
                        <td class="px-3 py-3 whitespace-nowrap text-sm ${timeClass}">${race.time}</td>
                        <td class="px-3 py-3 whitespace-nowrap text-sm ${nameClass} flex items-center">
                            ${translatedRaceName}
                            ${badgeHtml}
                        </td>
                        <td class="px-3 py-3 whitespace-nowrap text-sm text-gray-500">${race.distance}</td>
                        <td class="px-3 py-3 whitespace-nowrap text-sm text-center text-gray-500">${race.horses > 0 ? race.horses : '-'}</td>
                    </tr>
                `;
            });

            tableBody.innerHTML = bodyHtml;
        }

        /**
         * Handles track tab click and updates the UI
         */
        function selectTab(trackKey) {
            currentTrackKey = trackKey;

            // Remove active class from all buttons
            tabButtons.forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('text-gray-500');
                btn.classList.add('hover:text-blue-600');
            });

            // Add active class to the selected button
            const activeTab = document.querySelector(`[data-track="${trackKey}"]`);
            if (activeTab) {
                activeTab.classList.add('tab-active');
                activeTab.classList.remove('text-gray-500');
            }

            // Render the schedule with new track and current language
            renderSchedule(trackKey);
        }

        /**
         * Handles language button click and updates the entire UI.
         */
        function switchLanguage(lang) {
            currentLang = lang;

            // Update language button styles
            langButtons.forEach(btn => {
                btn.classList.remove('lang-active');
                btn.classList.remove('text-white');
                btn.classList.add('text-gray-600');
            });

            const activeLangButton = document.querySelector(`[data-lang="${lang}"]`);
            if (activeLangButton) {
                activeLangButton.classList.add('lang-active');
                activeLangButton.classList.remove('text-gray-600');
            }

            // Update all static text elements
            updateTextElements(lang);

            // Re-render the schedule table with the new language
            renderSchedule(currentTrackKey);
        }

        // --- INITIALIZATION ---
        // Add event listeners to track tab buttons
        tabButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                const trackKey = e.currentTarget.dataset.track;
                selectTab(trackKey);
            });
        });

        // Add event listeners to language buttons
        langButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                const lang = e.currentTarget.dataset.lang;
                switchLanguage(lang);
            });
        });

        // Initialize the app: default language to Japanese, default track to Tokyo
        switchLanguage('ja');
        selectTab('tokyo');
    </script>
</body>
</html>
